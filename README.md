# API для управления складом

## Описание проекта

Этот проект представляет собой REST API, разработанный с использованием FastAPI для управления процессами на складе. Он предоставляет эндпоинты для управления товарами, запасами и заказами, обеспечивая эффективную работу склада.

### Основные функции:
- **Управление товарами**: создание, просмотр, обновление и удаление товаров.
- **Управление заказами**: размещение заказов, получение информации о заказах, обновление статуса заказа и управление запасами.
- **Проверка запасов**: гарантирует, что заказы могут быть размещены только при наличии достаточного количества товаров на складе, и автоматически уменьшает количество товаров при создании заказа.
- **Документация**: встроенная документация FastAPI (Swagger/OpenAPI) для удобного взаимодействия с API.

## Структура базы данных
Проект использует SQLAlchemy 2.0 для взаимодействия с базой данных PostgreSQL и включает следующие сущности:
- **Product (Товар)**: представляет товары на складе.
  - Поля: `id`, `name` (название), `description` (описание), `price` (цена), `quantity` (количество)
- **Order (Заказ)**: представляет заказы клиентов.
  - Поля: `id`, `created_at` (дата создания), `status` (статус, например, "в процессе", "отправлен", "доставлен")
- **OrderItem (Элемент заказа)**: представляет товары в заказе.
  - Поля: `id`, `order_id` (ID заказа), `product_id` (ID товара), `quantity` (количество товара в заказе)

## Эндпоинты
### Товары:
- **POST** `/products`: Создать новый товар.
- **GET** `/products`: Получить список всех товаров.
- **GET** `/products/{id}`: Получить информацию о товаре по ID.
- **PUT** `/products/{id}`: Обновить информацию о товаре.
- **DELETE** `/products/{id}`: Удалить товар.

### Заказы:
- **POST** `/orders`: Создать новый заказ.
- **GET** `/orders`: Получить список всех заказов.
- **GET** `/orders/{id}`: Получить информацию о заказе по ID.
- **PATCH** `/orders/{id}/status`: Обновить статус заказа.

## Бизнес-логика
- **Проверка наличия на складе**: Перед созданием заказа система проверяет, достаточно ли товаров на складе для выполнения заказа.
- **Обновление запасов**: После успешного создания заказа количество доступных товаров на складе обновляется.
- **Обработка ошибок**: В случае недостаточного количества товаров возвращается сообщение об ошибке, и заказ не создается.

## Тестирование
Проект включает тесты, написанные с использованием `pytest`, которые проверяют основные функции API:
- Создание, обновление и удаление товаров
- Размещение заказов и проверка наличия товаров
- Обновление статуса заказов

## Docker
Проект контейнеризован с использованием Docker. Можно запустить API и базу данных PostgreSQL с помощью `docker-compose` для удобного развертывания и локальной разработки.

### Команды:
- **Сборка и запуск контейнеров**: `docker-compose up --build`
- **Остановка контейнеров**: `docker-compose down`

## Установка и настройка
### 1. Клонирование репозитория

```
git clone <url-репозитория>
cd warehouse-api
```

### 2. Установка зависимостей

```
pip install -r requirements.txt
```

### 3. Настройка базы данных
Перед запуском проекта необходимо настроить параметры подключения к базе данных PostgreSQL. Для этого в файле .env нужно указать следующие параметры:

```
DB_USER=your_db_user
DB_PASS=your_db_password
DB_HOST=localhost
DB_PORT=5432
DB_NAME=warehouse
```

### 4. Инициализация базы данных
Для инициализации базы данных выполните команду для создания таблиц:

```
alembic upgrade head
```

### 5. Запуск приложения

```
uvicorn src.main:app --reload
```
